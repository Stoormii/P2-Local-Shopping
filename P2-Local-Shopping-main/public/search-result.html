<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Search Results</title>
  <link rel="stylesheet" href="css/ValentinoStylesheet.css">
</head>
<body>
  <div class="main-container">
    <header class="topnav">
      <a class="active" href="frontpage.html">Shop Local</a>
    </header>

    <section>
      <h2>Search Results</h2>
      <div id="results"></div>
    </section>
    <script>
      function getQueryParam() {
        const params = new URLSearchParams(window.location.search);
        return params.get("query")?.toLowerCase() || "";
      }
    
      async function fetchSearchResults(query) {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";
    
        try {
          const response = await fetch(`/search?query=${encodeURIComponent(query)}`);
          const data = await response.json();
    
          if (data.length === 0) {
            resultsDiv.innerHTML = "<p>No results found.</p>";
            return;
          }
    
          const productSection = document.createElement("div");
          productSection.innerHTML = "<h3>Matching Products</h3>";
    
          data.forEach(p => {
            const item = document.createElement("div");
            item.className = "product";
            item.innerHTML = `
              <img src="${p.img || 'img/black-tshirt.jpg'}" alt="${p.name}" width="100">
              <div><strong>${p.name}</strong></div>
            `;
            productSection.appendChild(item);
          });
    
          resultsDiv.appendChild(productSection);
        } catch (error) {
          console.error("Error fetching search results:", error);
          resultsDiv.innerHTML = "<p>Error loading results.</p>";
        }
      }
    
      // Run on page load
      const query = getQueryParam();
      if (query) {
        fetchSearchResults(query);
      }
    </script>
    
  </div>
</body>
</html>
